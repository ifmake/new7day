!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/cdk/bidi"),require("@angular/cdk/overlay"),require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("ng-zorro-antd/icon"),require("rxjs"),require("@angular/cdk/keycodes"),require("@angular/cdk/portal"),require("ng-zorro-antd/core/overlay"),require("ng-zorro-antd/core/util")):"function"==typeof define&&define.amd?define("ng-zorro-antd/mention",["exports","@angular/cdk/bidi","@angular/cdk/overlay","@angular/common","@angular/core","@angular/forms","ng-zorro-antd/icon","rxjs","@angular/cdk/keycodes","@angular/cdk/portal","ng-zorro-antd/core/overlay","ng-zorro-antd/core/util"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self)["ng-zorro-antd"]=t["ng-zorro-antd"]||{},t["ng-zorro-antd"].mention={}),t.ng.cdk.bidi,t.ng.cdk.overlay,t.ng.common,t.ng.core,t.ng.forms,t["ng-zorro-antd"].icon,t.rxjs,t.ng.cdk.keycodes,t.ng.cdk.portal,t["ng-zorro-antd"].core.overlay,t["ng-zorro-antd"].core.util)}(this,(function(t,e,n,i,o,r,s,a,l,c,u,g){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function h(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t}Object.create;var d=function(){};d.decorators=[{type:o.Directive,args:[{selector:"[nzMentionSuggestion]",exportAs:"nzMentionSuggestion"}]}];var f=function(){function t(){this.triggerChange$=new a.Subject}return t.prototype.triggerChanged=function(){return this.triggerChange$.asObservable()},t.prototype.registerTrigger=function(t){this.trigger!==t&&(this.trigger=t,this.triggerChange$.next(t))},t.prototype.ngOnDestroy=function(){this.triggerChange$.complete()},t}();f.decorators=[{type:o.Injectable}];var v={provide:r.NG_VALUE_ACCESSOR,useExisting:o.forwardRef((function(){return y})),multi:!0},y=function(){function t(t,e){this.el=t,this.nzMentionService=e,this.onChange=function(){},this.onTouched=function(){},this.onFocusin=new o.EventEmitter,this.onBlur=new o.EventEmitter,this.onInput=new o.EventEmitter,this.onKeydown=new o.EventEmitter,this.onClick=new o.EventEmitter}return t.prototype.completeEvents=function(){this.onFocusin.complete(),this.onBlur.complete(),this.onInput.complete(),this.onKeydown.complete(),this.onClick.complete()},t.prototype.focus=function(t){this.el.nativeElement.focus(),this.el.nativeElement.setSelectionRange(t,t)},t.prototype.insertMention=function(t){var e=this.el.nativeElement.value,n=t.mention.trim()+" ",i=[e.slice(0,t.startPos+1),n,e.slice(t.endPos,e.length)].join("");this.el.nativeElement.value=i,this.focus(t.startPos+n.length+1),this.onChange(i),this.value=i},t.prototype.writeValue=function(t){this.value=t,this.el.nativeElement.value="string"==typeof t?t:""},t.prototype.registerOnChange=function(t){this.onChange=t},t.prototype.registerOnTouched=function(t){this.onTouched=t},t.prototype.ngAfterViewInit=function(){this.nzMentionService.registerTrigger(this)},t.prototype.ngOnDestroy=function(){this.completeEvents()},t}();y.decorators=[{type:o.Directive,args:[{selector:"input[nzMentionTrigger], textarea[nzMentionTrigger]",exportAs:"nzMentionTrigger",providers:[v],host:{autocomplete:"off","(focusin)":"onFocusin.emit()","(blur)":"onBlur.emit()","(input)":"onInput.emit($event)","(keydown)":"onKeydown.emit($event)","(click)":"onClick.emit($event)"}}]}],y.ctorParameters=function(){return[{type:o.ElementRef},{type:f}]};var m=function(){function t(t,e,n,i,r){this.ngDocument=t,this.cdr=e,this.overlay=n,this.viewContainerRef=i,this.nzMentionService=r,this.nzValueWith=function(t){return t},this.nzPrefix="@",this.nzLoading=!1,this.nzNotFoundContent="无匹配结果，轻敲空格完成输入",this.nzPlacement="bottom",this.nzSuggestions=[],this.nzOnSelect=new o.EventEmitter,this.nzOnSearchChange=new o.EventEmitter,this.isOpen=!1,this.filteredSuggestions=[],this.suggestionTemplate=null,this.activeIndex=-1,this.previousValue=null,this.cursorMention=null,this.overlayRef=null}return Object.defineProperty(t.prototype,"suggestionChild",{set:function(t){t&&(this.suggestionTemplate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triggerNativeElement",{get:function(){return this.trigger.el.nativeElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusItemElement",{get:function(){var t,e=null===(t=this.items)||void 0===t?void 0:t.toArray();return e&&e[this.activeIndex]?e[this.activeIndex].nativeElement:null},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.nzMentionService.triggerChanged().subscribe((function(e){t.trigger=e,t.bindTriggerEvents(),t.closeDropdown(),t.overlayRef=null}))},t.prototype.ngOnChanges=function(t){t.hasOwnProperty("nzSuggestions")&&this.isOpen&&(this.previousValue=null,this.activeIndex=-1,this.resetDropdown(!1))},t.prototype.ngOnDestroy=function(){this.closeDropdown()},t.prototype.closeDropdown=function(){this.overlayRef&&this.overlayRef.hasAttached()&&(this.overlayRef.detach(),this.overlayOutsideClickSubscription.unsubscribe(),this.isOpen=!1,this.cdr.markForCheck())},t.prototype.openDropdown=function(){this.attachOverlay(),this.isOpen=!0,this.cdr.markForCheck()},t.prototype.getMentions=function(){return this.trigger?g.getMentions(this.trigger.value,this.nzPrefix):[]},t.prototype.selectSuggestion=function(t){var e=this.nzValueWith(t);this.trigger.insertMention({mention:e,startPos:this.cursorMentionStart,endPos:this.cursorMentionEnd}),this.nzOnSelect.emit(t),this.closeDropdown(),this.activeIndex=-1},t.prototype.handleInput=function(t){var e=t.target;this.trigger.onChange(e.value),this.trigger.value=e.value,this.resetDropdown()},t.prototype.handleKeydown=function(t){var e=t.keyCode;if(this.isOpen&&e===l.ENTER&&-1!==this.activeIndex&&this.filteredSuggestions.length)this.selectSuggestion(this.filteredSuggestions[this.activeIndex]),t.preventDefault();else if(e===l.LEFT_ARROW||e===l.RIGHT_ARROW)this.resetDropdown(),t.stopPropagation();else{if(this.isOpen&&(e===l.TAB||e===l.ESCAPE))return void this.closeDropdown();this.isOpen&&e===l.UP_ARROW&&(this.setPreviousItemActive(),t.preventDefault(),t.stopPropagation()),this.isOpen&&e===l.DOWN_ARROW&&(this.setNextItemActive(),t.preventDefault(),t.stopPropagation())}},t.prototype.handleClick=function(){this.resetDropdown()},t.prototype.bindTriggerEvents=function(){var t=this;this.trigger.onInput.subscribe((function(e){return t.handleInput(e)})),this.trigger.onKeydown.subscribe((function(e){return t.handleKeydown(e)})),this.trigger.onClick.subscribe((function(){return t.handleClick()}))},t.prototype.suggestionsFilter=function(t,e){var n=this,i=t.substring(1);if(this.previousValue!==t||t===this.cursorMention[0]){this.previousValue=t,e&&this.nzOnSearchChange.emit({value:this.cursorMention.substring(1),prefix:this.cursorMention[0]});var o=i.toLowerCase();this.filteredSuggestions=this.nzSuggestions.filter((function(t){return n.nzValueWith(t).toLowerCase().includes(o)}))}},t.prototype.resetDropdown=function(t){if(void 0===t&&(t=!0),this.resetCursorMention(),"string"==typeof this.cursorMention&&this.canOpen()){this.suggestionsFilter(this.cursorMention,t);var e=this.filteredSuggestions.indexOf(this.cursorMention.substring(1));this.activeIndex=e>=0?e:0,this.openDropdown()}else this.closeDropdown()},t.prototype.setNextItemActive=function(){this.activeIndex=this.activeIndex+1<=this.filteredSuggestions.length-1?this.activeIndex+1:0,this.cdr.markForCheck(),this.scrollToFocusItem()},t.prototype.setPreviousItemActive=function(){this.activeIndex=this.activeIndex-1<0?this.filteredSuggestions.length-1:this.activeIndex-1,this.cdr.markForCheck(),this.scrollToFocusItem()},t.prototype.scrollToFocusItem=function(){this.focusItemElement&&this.focusItemElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},t.prototype.canOpen=function(){var t=this.triggerNativeElement;return!t.readOnly&&!t.disabled},t.prototype.resetCursorMention=function(){for(var t=this.triggerNativeElement.value.replace(/[\r\n]/g," ")||"",e=this.triggerNativeElement.selectionStart,n="string"==typeof this.nzPrefix?[this.nzPrefix]:this.nzPrefix,i=n.length;i>=0;){var o=t.lastIndexOf(n[i],e),r=t.indexOf(" ",e)>-1?t.indexOf(" ",e):t.length,s=t.substring(o,r);if(!(o>0&&" "!==t[o-1]||o<0||s.includes(n[i],1)||s.includes(" ")))return this.cursorMention=s,this.cursorMentionStart=o,void(this.cursorMentionEnd=r);this.cursorMention=null,this.cursorMentionStart=-1,this.cursorMentionEnd=-1,i--}},t.prototype.updatePositions=function(){var t=g.getCaretCoordinates(this.triggerNativeElement,this.cursorMentionStart),e=t.top-this.triggerNativeElement.getBoundingClientRect().height-this.triggerNativeElement.scrollTop+("bottom"===this.nzPlacement?t.height-6:-6),n=t.left-this.triggerNativeElement.scrollLeft;this.positionStrategy.withDefaultOffsetX(n).withDefaultOffsetY(e),"bottom"===this.nzPlacement&&this.positionStrategy.withPositions(p(u.DEFAULT_MENTION_BOTTOM_POSITIONS)),"top"===this.nzPlacement&&this.positionStrategy.withPositions(p(u.DEFAULT_MENTION_TOP_POSITIONS)),this.positionStrategy.apply()},t.prototype.subscribeOverlayOutsideClick=function(){var t=this;return a.merge(this.overlayRef.outsidePointerEvents(),a.fromEvent(this.ngDocument,"touchend")).subscribe((function(e){var n,i=e.target;t.isOpen&&i!==t.trigger.el.nativeElement&&!(null===(n=t.overlayRef)||void 0===n?void 0:n.overlayElement.contains(i))&&t.closeDropdown()}))},t.prototype.attachOverlay=function(){this.overlayRef||(this.portal=new c.TemplatePortal(this.suggestionsTemp,this.viewContainerRef),this.overlayRef=this.overlay.create(this.getOverlayConfig())),this.overlayRef&&!this.overlayRef.hasAttached()&&(this.overlayRef.attach(this.portal),this.overlayOutsideClickSubscription=this.subscribeOverlayOutsideClick()),this.updatePositions()},t.prototype.getOverlayConfig=function(){return new n.OverlayConfig({positionStrategy:this.getOverlayPosition(),scrollStrategy:this.overlay.scrollStrategies.reposition(),disposeOnNavigation:!0})},t.prototype.getOverlayPosition=function(){var t=[new n.ConnectionPositionPair({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"top"}),new n.ConnectionPositionPair({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"})];return this.positionStrategy=this.overlay.position().flexibleConnectedTo(this.trigger.el).withPositions(t).withFlexibleDimensions(!1).withPush(!1),this.positionStrategy},t}();m.decorators=[{type:o.Component,args:[{selector:"nz-mention",exportAs:"nzMention",template:'\n    <ng-content></ng-content>\n    <ng-template #suggestions>\n      <ul class="ant-mention-dropdown">\n        <li\n          #items\n          class="ant-mention-dropdown-item"\n          *ngFor="let suggestion of filteredSuggestions; let i = index"\n          [class.focus]="i === activeIndex"\n          (mousedown)="$event.preventDefault()"\n          (click)="selectSuggestion(suggestion)"\n        >\n          <ng-container *ngIf="suggestionTemplate; else defaultSuggestion">\n            <ng-container *ngTemplateOutlet="suggestionTemplate; context: { $implicit: suggestion }"></ng-container>\n          </ng-container>\n          <ng-template #defaultSuggestion>{{ nzValueWith(suggestion) }}</ng-template>\n        </li>\n        <li class="ant-mention-dropdown-notfound ant-mention-dropdown-item" *ngIf="filteredSuggestions.length === 0">\n          <span *ngIf="nzLoading"><i nz-icon nzType="loading"></i></span>\n          <span *ngIf="!nzLoading">{{ nzNotFoundContent }}</span>\n        </li>\n      </ul>\n    </ng-template>\n  ',preserveWhitespaces:!1,changeDetection:o.ChangeDetectionStrategy.OnPush,providers:[f]}]}],m.ctorParameters=function(){return[{type:void 0,decorators:[{type:o.Optional},{type:o.Inject,args:[i.DOCUMENT]}]},{type:o.ChangeDetectorRef},{type:n.Overlay},{type:o.ViewContainerRef},{type:f}]},m.propDecorators={nzValueWith:[{type:o.Input}],nzPrefix:[{type:o.Input}],nzLoading:[{type:o.Input}],nzNotFoundContent:[{type:o.Input}],nzPlacement:[{type:o.Input}],nzSuggestions:[{type:o.Input}],nzOnSelect:[{type:o.Output}],nzOnSearchChange:[{type:o.Output}],suggestionsTemp:[{type:o.ViewChild,args:[o.TemplateRef,{static:!1}]}],items:[{type:o.ViewChildren,args:["items",{read:o.ElementRef}]}],suggestionChild:[{type:o.ContentChild,args:[d,{static:!1,read:o.TemplateRef}]}]},function(t,e,n,i){var o,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);r>3&&s&&Object.defineProperty(e,n,s)}([g.InputBoolean(),function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",Object)],m.prototype,"nzLoading",void 0);var O=[m,y,d],z=function(){};z.decorators=[{type:o.NgModule,args:[{imports:[e.BidiModule,i.CommonModule,r.FormsModule,n.OverlayModule,s.NzIconModule],declarations:p(O),exports:p(O)}]}],t.NZ_MENTION_TRIGGER_ACCESSOR=v,t.NzMentionComponent=m,t.NzMentionModule=z,t.NzMentionService=f,t.NzMentionSuggestionDirective=d,t.NzMentionTriggerDirective=y,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-zorro-antd-mention.umd.min.js.map